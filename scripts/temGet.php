<?php

// get default values for a tem in the database

require_once $_SERVER['DOCUMENT_ROOT'] . '/include/main_func.php';
auth();

$return = array(
	'error' => false,
	'errorText' => '',
);

$user = $_SESSION['user_id'];
$tem_id = intval($_POST['tem_id']);

$q = new myQuery("SELECT name FROM tem WHERE id=" . $tem_id);
$return['name'] = $q->get_one();

$q = new myQuery("SELECT n as i, name, x, y FROM point WHERE tem_id=" . $tem_id . " ORDER BY n");
$return['default_tem'] = $q->get_assoc();

$q = new myQuery("SELECT points FROM line WHERE tem_id=" . $tem_id . " ORDER BY n");
$return['default_lines'] = array_map(function($a) { 
	return explode(',', $a['points']);
}, $q->get_assoc());

$q = new myQuery("SELECT n, color FROM line WHERE tem_id=" . $tem_id . " ORDER BY n");
$return['line_colors'] = $q->get_assoc(false, false, 'color');

$q = new myQuery("SELECT 3ptdelin1, 3ptdelin2, 3ptdelin3 FROM tem WHERE id=" . $tem_id);
$pts = $q->get_row();
$return['fitPoints'] = array($pts['3ptdelin1'], $pts['3ptdelin2'], $pts['3ptdelin3']);

scriptReturn($return);

exit;

/*

CREATE TABLE tem (
	id INT(11) NOT NULL AUTO_INCREMENT,
	user_id INT(4) NOT NULL,
	name VARCHAR(255) NOT NULL,
	notes TEXT,
	public BOOL DEFAULT 0,
	3ptdelin1 INT(4),
	3ptdelin2 INT(4),
	3ptdelin3 INT(4),
	PRIMARY KEY (id)
);

INSERT INTO tem VALUES (1, 1, "FRL-189", "Face Research Lab 189-point front face template", TRUE, 0, 1, 96);

CREATE TABLE point (
	tem_id INT(11) NOT NULL,
	n INT(4) NOT NULL,
	name VARCHAR(255) NOT NULL,
	x DECIMAL(7,3),
	y DECIMAL(7,3),
	sym INT(4),
	CONSTRAINT id_n UNIQUE (tem_id, n)
);

INSERT INTO point (tem_id, n, name, x, y) VALUES 
(1, 0,  "left pupil", 165.659, 275.234),
(1, 1,  "right pupil", 284.339, 275.231),
(1, 2,  "top of left iris", 165.219, 267.225),
(1, 3,  "top-left of left iris", 155.781, 269.909),
(1, 4,  "left of left iris", 154.252, 276.694),
(1, 5,  "bottom-left of left iris", 157.117, 282.607),
(1, 6,  "bottom of left iris", 165.507, 286.083),
(1, 7,  "bottom-right of left iris", 173.839, 282.517),
(1, 8,  "right of left iris", 176.72, 276.472),
(1, 9,  "top-right of left iris", 175.04, 270.366),
(1, 10,  "top of right iris", 284.848, 267.261),
(1, 11,  "top-left of right iris", 274.767, 270.397),
(1, 12,  "left of right iris", 273.12, 276.515),
(1, 13,  "bottom-left of right iris", 276.247, 282.697),
(1, 14,  "bottom of right iris", 284.613, 286.075),
(1, 15,  "bottom-right of right iris", 292.915, 282.607),
(1, 16,  "right of right iris", 295.682, 276.435),
(1, 17,  "top-right of right iris", 294.057, 269.766),
(1, 18,  "outside corner of left eye", 142.108, 276.83),
(1, 19,  "top-left of left eye", 151.046, 270.185),
(1, 20,  "top-centre of left eye", 165.185, 266.927),
(1, 21,  "top-right of left eye", 178.974, 271.116),
(1, 22,  "inside corner of left eye", 192.483, 283.306),
(1, 23,  "inside corner of right eye", 257.441, 282.92),
(1, 24,  "top-left of right eye", 270.737, 271.346),
(1, 25,  "top-centre of right eye", 284.868, 266.907),
(1, 26,  "top-right of right eye", 298.625, 270.203),
(1, 27,  "outside corner of right eye", 308.015, 277.239),
(1, 28,  "bottom-left of left eye", 151.143, 284.549),
(1, 29,  "bottom-centre of left eye", 165.084, 287.113),
(1, 30,  "bottom-right of left eye", 179.231, 284.827),
(1, 31,  "bottom-left of right eye", 271.138, 284.751),
(1, 32,  "bottom-centre of right eye", 284.95, 286.988),
(1, 33,  "bottom-right of right eye", 298.825, 284.346),
(1, 34,  "left of crease above left eye", 133.555, 270.533),
(1, 35,  "centre-left of crease above left eye", 146.59, 261.693),
(1, 36,  "centre of crease above left eye (above pupil)", 163.618, 258.955),
(1, 37,  "centre-right of crease above left eye", 179.507, 262.315),
(1, 38,  "right of crease above left eye", 191.157, 271.462),
(1, 39,  "left of crease above right eye", 258.816, 271.085),
(1, 40,  "centre-left of crease above right eye", 270.695, 261.832),
(1, 41,  "centre of crease above right eye (above pupil)", 286.533, 258.578),
(1, 42,  "centre-right of crease above right eye", 303.409, 261.458),
(1, 43,  "right of crease above right eye", 316.183, 270.037),
(1, 44,  "bottom-left of circle under left eye", 161.285, 316.869),
(1, 45,  "centre of circle under left eye", 181.236, 307.697),
(1, 46,  "top-right of circle under left eye", 196.632, 294.275),
(1, 47,  "top-left of circle under right eye", 253.365, 293.574),
(1, 48,  "centre of circle under right eye", 268.783, 307.533),
(1, 49,  "bottom-right of circle under right eye", 288.725, 316.595),
(1, 50,  "left side of bridge of nose (towards eyebrow)", 213.257, 266.444),
(1, 51,  "left side of bridge of nose (in line with inside corners of eyes)", 217.322, 282.619),
(1, 52,  "left side of bridge of nose", 217.736, 300.805),
(1, 53,  "left side of bridge of nose", 215.574, 318.661),
(1, 54,  "left side of tip of nose (most bulbous part)", 211.113, 336.857),
(1, 55,  "bottom-centre of nose", 225.164, 365.203),
(1, 56,  "right side of bridge of nose (towards eyebrow)", 236.489, 266.452),
(1, 57,  "right side of bridge of nose (in line with inside corners of eyes)", 232.617, 282.927),
(1, 58,  "right side of bridge of nose", 232.313, 300.779),
(1, 59,  "right side of bridge of nose", 234.351, 318.581),
(1, 60,  "right side of tip of nose (most bulbous part)", 238.809, 337.277),
(1, 61,  "top of left outer nostril", 193.865, 335.227),
(1, 62,  "upper-left of left outer nostril", 189.321, 343.98),
(1, 63,  "lower-left of left outer nostril", 189.021, 354.23),
(1, 64,  "bottom of left out nostril", 197.432, 362.45),
(1, 65,  "left edge of left inner nostril", 200.853, 355.684),
(1, 66,  "top of right outer nostril", 255.876, 335.027),
(1, 67,  "upper-right of right outer nostril", 260.183, 344.247),
(1, 68,  "lower-right of right outer nostril", 260.275, 354.713),
(1, 69,  "bottom of right outer nostril", 251.893, 362.727),
(1, 70,  "right edge of right inner nostril", 248.682, 356.117),
(1, 71,  "left corner of left eyebrow", 114.931, 252.487),
(1, 72,  "top of left eyebrow", 127.482, 233.462),
(1, 73,  "top of left eyebrow", 146.085, 225.529),
(1, 74,  "top of left eyebrow above pupil", 167.903, 225.965),
(1, 75,  "top-right of left eyebrow", 193.08, 233.973),
(1, 76,  "bottom-right of left eyebrow", 197.668, 250.158),
(1, 77,  "bottom-left or right eyebrow", 252.334, 249.733),
(1, 78,  "top-left of right eyebrow", 256.363, 232.894),
(1, 79,  "top of right eyebrow above pupil", 280.671, 225.789),
(1, 80,  "top of right eyebrow", 303.069, 225.111),
(1, 81,  "top of right eyebrow", 322.582, 233.182),
(1, 82,  "right corner of right eyebrow", 335.66, 252.609),
(1, 83,  "bottom of left eyebrow", 140.729, 242.488),
(1, 84,  "bottom of left eyebrow above pupil", 168.388, 243.433),
(1, 85,  "bottom of right eyebrow above pupil", 280.452, 243.817),
(1, 86,  "bottom of right eyebrow", 308.743, 242.022),
(1, 87,  "left corner of the mouth", 177.127, 407.04),
(1, 88,  "left of top of upper lip", 194.167, 396.684),
(1, 89,  "left point of upper lip", 212.058, 390.034),
(1, 90,  "centre of top of upper lip", 225.466, 393.407),
(1, 91,  "right point of upper lip", 239.192, 390.067),
(1, 92,  "right of top of upper lip", 255.878, 396.803),
(1, 93,  "right corner of the mouth", 272.862, 406.987),
(1, 94,  "left of bottom of upper lip", 195.087, 406.517),
(1, 95,  "left-centre of bottom of upper lip", 210.28, 405.994),
(1, 96,  "centre of bottom of upper lip", 225.359, 407.61),
(1, 97,  "right-centre of bottom of upper lip", 240.155, 406.06),
(1, 98,  "right of bottom of upper lip", 255.352, 406.513),
(1, 99,  "left of top of lower lip", 195.08, 406.524),
(1, 100,  "left-centre of top of lower lip", 210.284, 406.067),
(1, 101,  "centre of top of lower lip", 225.359, 407.627),
(1, 102,  "right-centre of top of lower lip", 240.145, 406.1),
(1, 103,  "right of top of lower lip", 255.344, 406.523),
(1, 104,  "left of bottom of lower lip", 189.693, 420.88),
(1, 105,  "left-center of bottom of lower lip", 206.951, 428.417),
(1, 106,  "centre of bottom of lower lip", 226.161, 430.47),
(1, 107,  "right-centre of bottom of lower lip", 245.472, 427.967),
(1, 108,  "right of bottom of lower lip", 261.762, 420.103),
(1, 109,  "where top of left ear meets head", 93.8573, 272.922),
(1, 110,  "middle of where left ear meets head", 93.9448, 314.406),
(1, 111,  "where bottom of left ear meets head", 101.744, 364.507),
(1, 112,  "where top of right ear meets head", 356.32, 274.13),
(1, 113,  "middle of where right ear meets head", 356.097, 315.199),
(1, 114,  "where bottom of right ear meets head", 348.537, 365.196),
(1, 115,  "top of left ear", 73.582, 263.505),
(1, 116,  "upper-middle outside of left ear", 66.1284, 286.517),
(1, 117,  "middle outside of left ear", 71.9438, 316.328),
(1, 118,  "lower-middle outside of left ear", 79.9652, 342.987),
(1, 119,  "bottom of left earlobe", 91.1456, 361.577),
(1, 120,  "top of right ear", 376.99, 263.53),
(1, 121,  "upper-middle outside of right ear", 385.844, 284.198),
(1, 122,  "middle outside of right ear", 380.684, 313.898),
(1, 123,  "lower-middle outside of right ear", 372.031, 342.77),
(1, 124,  "bottom of right earlobe", 359.624, 362.45),
(1, 125,  "left jaw between ear and neck", 110.107, 398.881),
(1, 126,  "where the left side of the neck meets the face", 127.821, 432.197),
(1, 127,  "left jaw", 157.104, 462.874),
(1, 128,  "bottom left corner of the chin", 187.939, 484.317),
(1, 129,  "bottom centre of the chin", 226.285, 492.823),
(1, 130,  "bottom right corner of the chin", 265.001, 482.883),
(1, 131,  "right jaw", 295.021, 461.943),
(1, 132,  "where the right side of the neck meets the face", 320.782, 435.683),
(1, 133,  "right jaw between ear and neck", 339.447, 402.71),
(1, 134,  "hairline", 97.8972, 236.923),
(1, 135,  "hairline", 109.213, 201.536),
(1, 136,  "left temple hairline", 124.875, 168.666),
(1, 137,  "hairline", 149.897, 144.943),
(1, 138,  "hairline", 184.038, 131.801),
(1, 139,  "centre of hairline", 225.292, 130.893),
(1, 140,  "hairline", 265.95, 131.677),
(1, 141,  "hairline", 299.404, 144.27),
(1, 142,  "right temple hairline", 325.215, 167.819),
(1, 143,  "hairline", 341.153, 200.47),
(1, 144,  "hairline", 352.69, 237.364),
(1, 145,  "left side of the neck, about 3cm down from the jaw", 127.562, 488.43),
(1, 146,  "outside left earlobe (creates oval around head)", 62.0577, 391.151),
(1, 147,  "about 2cm to the left of the top of the left ear (creates oval around head)", 48.029, 271.213),
(1, 148,  "outside left temple (creates oval around head)", 67.2244, 200.078),
(1, 149,  "top of head above left temple", 93.6919, 121.525),
(1, 150,  "top of head between left temple and centre", 146.664, 73.5377),
(1, 151,  "centre top of head", 225.092, 54.7745),
(1, 152,  "top of head between right temple and centre", 302.626, 72.0746),
(1, 153,  "top of head above right temple", 357.083, 120.851),
(1, 154,  "outside right temple (creates oval around head)", 383.97, 199.494),
(1, 155,  "about 2cm to the right of the top of the right ear (creates oval around head)", 404.227, 273.254),
(1, 156,  "outside right earlobe (creates oval around head)", 388.837, 394.87),
(1, 157,  "right side of the neck, about 3cm down from the jaw", 319.684, 491.787),
(1, 158,  "top of left smile line", 177.725, 362.17),
(1, 159,  "centre of left smile line", 166.392, 377.43),
(1, 160,  "bottom of left smile line", 157.854, 396.564),
(1, 161,  "top of right smile line", 273.52, 361.877),
(1, 162,  "centre of right smile line", 285.38, 377.077),
(1, 163,  "bottom of right smile line", 294.096, 396.26),
(1, 164,  "top-left of left cheekbone", 112.197, 326.048),
(1, 165,  "centre of left cheekbone", 136.054, 339.16),
(1, 166,  "bottom-right of left cheekbone", 162.121, 341.64),
(1, 167,  "top-right of right cheekbone", 339.08, 326.439),
(1, 168,  "centre of right cheekbone", 315.804, 339.457),
(1, 169,  "bottom-left of right cheekbone", 289.394, 342.313),
(1, 170,  "top-left of philtrum", 214.336, 368.384),
(1, 171,  "bottom-left of philtrum", 212.361, 384.327),
(1, 172,  "top-right of philtrum", 236.169, 368.267),
(1, 173,  "bottom-right of philtrum", 238.504, 384.07),
(1, 174,  "top of chin dimple", 225.928, 459.434),
(1, 175,  "bottom of chin dimple", 226.027, 475.177),
(1, 176,  "left of horizontal crease under chin", 202.474, 446.98),
(1, 177,  "centre of horizontal crease under chin", 226.101, 441.267),
(1, 178,  "right of horizontal crease under chin", 249.198, 446.907),
(1, 179,  "right edge of left inner nostril", 212.122, 357.51),
(1, 180,  "right edge of septum (divides nostril)", 218.164, 363.26),
(1, 181,  "left edge of septum (divides nostril)", 231.713, 363.21),
(1, 182,  "left edge of right inner nostril", 237.765, 357.323),
(1, 183,  "left of the adams apple", 187.842, 533.69),
(1, 184,  "right of the adams apple", 259.213, 534.573),
(1, 185,  "upper-middle of where left ear meets face", 92.9994, 295.162),
(1, 186,  "lower-middle of where left ear meets face", 96.5338, 333.401),
(1, 187,  "upper-middle of where right ear meets face", 357.087, 295.341),
(1, 188,  "lower-middle of where right ear meets face", 353.337, 334.473);

CREATE TABLE line (
	tem_id INT(11) NOT NULL,
	n INT(4) NOT NULL,
	linetype ENUM('open', 'closed') DEFAULT 'open',
	points VARCHAR(255) NOT NULL,
	color ENUM('blue', 'red', 'green', 'yellow') DEFAULT 'blue',
	CONSTRAINT id_n UNIQUE (tem_id, n)
);

REPLACE INTO line VALUES 
(1, 0, 1, '0,0', 'blue'),
(1, 1, 1, '1,1', 'blue'),
(1, 2, 1, '2,3,4,5,6,7,8,9,2', 'blue'),
(1, 3, 1, '10,11,12,13,14,15,16,17,10', 'blue'),
(1, 4, 1, '18,19,20,21,22', 'blue'),
(1, 5, 1, '23,24,25,26,27', 'blue'),
(1, 6, 1, '18,28,29,30,22', 'blue'),
(1, 7, 1, '23,31,32,33,27', 'blue'),
(1, 8, 1, '34,35,36,37,38', 'blue'),
(1, 9, 1, '39,40,41,42,43', 'blue'),
(1, 10, 1, '44,45,46', 'blue'),
(1, 11, 1, '47,48,49', 'blue'),
(1, 12, 1, '50,51,52,53,54,55', 'blue'),
(1, 13, 1, '56,57,58,59,60,55', 'blue'),
(1, 14, 1, '61,62,63,64,65,179,180,55', 'blue'),
(1, 15, 1, '66,67,68,69,70,182,181,55', 'blue'),
(1, 16, 1, '71,72,73,74,75,76', 'blue'),
(1, 17, 1, '77,78,79,80,81,82', 'blue'),
(1, 18, 1, '71,83,84,76', 'blue'),
(1, 19, 1, '77,85,86,82', 'blue'),
(1, 20, 1, '87,88,89,90,91,92,93', 'blue'),
(1, 21, 1, '87,94,95,96,97,98,93', 'red'),
(1, 22, 1, '87,99,100,101,102,103,93', 'blue'),
(1, 23, 1, '87,104,105,106,107,108,93', 'blue'),
(1, 24, 1, '109,185,110,186,111', 'blue'),
(1, 25, 1, '112,187,113,188,114', 'blue'),
(1, 26, 1, '109,115,116,117,118,119,111', 'blue'),
(1, 27, 1, '112,120,121,122,123,124,114', 'blue'),
(1, 28, 1, '109,134,135,136,137,138,139,140,141,142,143,144,112', 'blue'),
(1, 29, 1, '145,146,147,148,149,150,151,152,153,154,155,156,157', 'blue'),
(1, 30, 1, '158,159,160', 'blue'),
(1, 31, 1, '161,162,163', 'blue'),
(1, 32, 1, '164,165,166', 'blue'),
(1, 33, 1, '167,168,169', 'blue'),
(1, 34, 1, '170,171', 'blue'),
(1, 35, 1, '172,173', 'blue'),
(1, 36, 1, '174,175', 'blue'),
(1, 37, 1, '176,177,178', 'blue'),
(1, 38, 1, '126,145', 'blue'),
(1, 39, 1, '132,157', 'blue'),
(1, 40, 1, '145,183,184,157', 'blue'),
(1, 41, 1, '111,125,126', 'blue'),
(1, 42, 1, '126,127,128,129,130,131,132', 'blue'),
(1, 43, 1, '132,133,114', 'blue');

*/

?>